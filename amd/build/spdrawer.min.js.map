{"version":3,"sources":["../src/spdrawer.js"],"names":["define","$","CustomEvents","Log","SELECTORS","TOGGLE_REGION","TOGGLE_ACTION","TOGGLE_TARGET","TOGGLE_SIDE","BODY","SECTION","SPDrawer","length","debug","each","index","ele","trigger","find","drawerid","attr","drawer","document","getElementById","hidden","side","body","on","preventPageScroll","addClass","bind","registerEventListeners","small","width","closeAll","prototype","preference","removeClass","M","util","set_user_preference","toggleDrawer","e","target","closest","open","focus","children","delta","wheelDelta","originalEvent","detail","bottomOverflow","scrollTop","outerHeight","scrollHeight","topOverflow","preventDefault","element","events","activate","data","click"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for a drawer.\n *\n * @package    theme_fordson_fel\"\n * @copyright  2016 Damyon Wiese\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/custom_interaction_events', 'core/log'],\n     function($, CustomEvents, Log) {\n\n    var SELECTORS = {\n        TOGGLE_REGION: '[data-region=\"spdrawer-toggle\"]',\n        TOGGLE_ACTION: '[data-action=\"toggle-spdrawer\"]',\n        TOGGLE_TARGET: 'aria-controls',\n        TOGGLE_SIDE: 'right',\n        BODY: 'body',\n        SECTION: '.list-group-item[href*=\"#section-\"]'\n    };\n\n    /**\n     * Constructor for the Drawer.\n     *\n     * @param {object} root The root jQuery element for the modal\n     */\n    var SPDrawer = function() {\n\n        if (!$(SELECTORS.TOGGLE_REGION).length) {\n            Log.debug('Page is missing a spdrawer region');\n        }\n        if (!$(SELECTORS.TOGGLE_ACTION).length) {\n            Log.debug('Page is missing a spdrawer toggle link');\n        }\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n            var drawerid = trigger.attr('aria-controls');\n            var drawer = $(document.getElementById(drawerid));\n            var hidden = trigger.attr('aria-expanded') == 'false';\n            var side = trigger.attr('data-side');\n            var body = $(SELECTORS.BODY);\n\n            drawer.on('mousewheel DOMMouseScroll', this.preventPageScroll);\n\n            if (!hidden) {\n                body.addClass('spdrawer-open-' + side);\n                trigger.attr('aria-expanded', 'true');\n            } else {\n                trigger.attr('aria-expanded', 'false');\n            }\n        }.bind(this));\n\n        this.registerEventListeners();\n        var small = $(document).width() < 768;\n        if (small) {\n            this.closeAll();\n        }\n    };\n\n    SPDrawer.prototype.closeAll = function() {\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n            var side = trigger.attr('data-side');\n            var body = $(SELECTORS.BODY);\n            var drawerid = trigger.attr('aria-controls');\n            var drawer = $(document.getElementById(drawerid));\n            var preference = trigger.attr('data-preference');\n\n            trigger.attr('aria-expanded', 'false');\n            body.removeClass('drawer-open-' + side);\n            drawer.attr('aria-hidden', 'true');\n            drawer.addClass('closed');\n            M.util.set_user_preference(preference, 'false');\n        });\n    };\n\n    /**\n     * Open / close the blocks drawer.\n     *\n     * @method toggleDrawer\n     * @param {Event} e\n     */\n    SPDrawer.prototype.toggleDrawer = function(e) {\n        var trigger = $(e.target).closest('[data-action=toggle-spdrawer]');\n        var drawerid = trigger.attr('aria-controls');\n        var drawer = $(document.getElementById(drawerid));\n        var body = $(SELECTORS.BODY);\n        var side = trigger.attr('data-side');\n        var preference = trigger.attr('data-preference');\n\n        body.addClass('drawer-ease');\n        var open = trigger.attr('aria-expanded') == 'true';\n        if (!open) {\n            // Open.\n            trigger.attr('aria-expanded', 'true');\n            drawer.attr('aria-hidden', 'false');\n            drawer.focus();\n            body.addClass('drawer-open-' + side);\n            drawer.removeClass('closed');\n            trigger.children('i').removeClass('fa-arrow-left');\n            trigger.children('i').addClass('fa-arrow-right');\n            M.util.set_user_preference(preference, 'true');\n        } else {\n            // Close.\n            body.removeClass('drawer-open-' + side);\n            trigger.attr('aria-expanded', 'false');\n            drawer.attr('aria-hidden', 'true');\n            drawer.addClass('closed');\n            trigger.children('i').removeClass('fa-arrow-right');\n            trigger.children('i').addClass('fa-arrow-left');\n            M.util.set_user_preference(preference, 'false');\n        }\n    };\n\n    /**\n     * Prevent the page from scrolling when the drawer is at max scroll.\n     *\n     * @method preventPageScroll\n     * @param  {Event} e\n     */\n    SPDrawer.prototype.preventPageScroll = function(e) {\n        var delta = e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.originalEvent.detail,\n            bottomOverflow = (this.scrollTop + $(this).outerHeight() - this.scrollHeight) >= 0,\n            topOverflow = this.scrollTop <= 0;\n\n        if ((delta < 0 && bottomOverflow) || (delta > 0 && topOverflow)) {\n            e.preventDefault();\n        }\n    };\n\n    /**\n     * Set up all of the event handling for the modal.\n     *\n     * @method registerEventListeners\n     */\n    SPDrawer.prototype.registerEventListeners = function() {\n\n        $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\n            CustomEvents.define($(element), [CustomEvents.events.activate]);\n            $(element).on(CustomEvents.events.activate, function(e, data) {\n                this.toggleDrawer(data.originalEvent);\n                data.originalEvent.preventDefault();\n            }.bind(this));\n        }.bind(this));\n\n        $(SELECTORS.SECTION).click(function() {\n            var small = $(document).width() < 768;\n            if (small) {\n                this.closeAll();\n            }\n        }.bind(this));\n    };\n\n    return {\n        'init': function() {\n            return new SPDrawer();\n        }\n    };\n});\n"],"file":"spdrawer.min.js"}