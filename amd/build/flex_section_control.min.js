define(["jquery","core/config","core/log"],function(a,b,c){var d={init:function(b){M.course.id=b,a(".flexcontrol").on("click",this.togglestate),a(".flexsection-global-control").on("click",this.processglobal),a(".flexsections > .section > .content > .sectionname").on("click",this.proxysectionnameevent),c.debug("AMD Flex sections control initialized")},init_editing:function(b){M.course.id=b,a(".section.sub > .content > .section-content").css("display","block"),a(".section.sub > .content > .section-content").css("visibility","visible"),a(".section.sub > .content > .summary").css("display","block"),a(".section.sub > .content > .summary").css("visibility","visible"),a(".section.sub >.content > .flexsections").css("display","block"),a(".section.sub >.content > .flexsections").css("visibility","visible"),a("img.flexcontrol").attr("src",a("img.flexcontrol").attr("src").replace("collapsed","expanded")),a(".flexcontrol").on("click",this.togglestate),a(".flexsection-global-control").on("click",this.processglobal),c.debug("AMD Flex sections control initialized v1.2")},proxysectionnameevent:function(b){b.stopPropagation(),b.preventDefault();var c=a(this).find("img");c.trigger("click")},togglestate:function(d,e){d.stopPropagation(),d.preventDefault();var f=a(this);if(f.hasClass("sectioname"))var g=/sectioname-([0-9]+)-section-([0-9]+)/;else var g=/control-([0-9]+)-section-([0-9]+)/;var h=g.exec(f.attr("id")),i=parseInt(h[1]),j=parseInt(h[2]);g=/level-([0-9]+)/,h=g.exec(f.attr("class"));var k=parseInt(h[1]);c.debug("Working for flex section "+j+" of id "+i);var l=b.wwwroot+"/theme/fordson_fel/sections/ajax/register.php?";l+="sectionid="+i;var m=a("#control-"+i+"-section-"+j).attr("src");if(!e){var n=f.closest("li").parent().closest("li").attr("id");a.each(a("#"+n+" .flexcontrol.level-"+k),function(b,c){a(c).attr("id")!=f.attr("id")&&a(c).trigger("click",!0)})}if(a("#section-"+j).hasClass("expanded")||e===!0)a("#section-"+j).addClass("collapsed"),a("#section-"+j).removeClass("expanded"),c.debug("Changing section #section-title-"+j+" to false"),a("#section-title-"+j).attr("aria-expanded","false"),a("#section-"+j+" > .content > .section-content").addClass("collpased"),a("#section-"+j+" > .content > .section-content").removeClass("expanded"),m=m.replace("expanded","collapsed"),a("#control-"+i+"-section-"+j).attr("src",m),e=1;else{a("#section-"+j).addClass("expanded"),a("#section-"+j).removeClass("collapsed"),c.debug("Changing section #section-title-"+j+" to true"),a("#section-title-"+j).attr("aria-expanded","true"),a("#section-"+j+" > .content > .section-content").addClass("expanded"),a("#section-"+j+" > .content > .section-content").removeClass("collapsed"),m=m.replace("collapsed","expanded"),a("#control-"+i+"-section-"+j).attr("src",m),e=0;var o=f.offset();o.top-=70,a("html, body").animate({scrollTop:o.top,scrollLeft:0})}return l+="&hide="+e,a.get(l,function(){}),!1},processglobal:function(c){c.stopPropagation(),c.preventDefault();var d=a(this),e=/flexsections-control-([a-z]+)/,f=e.exec(d.attr("id")),g=f[1],h=b.wwwroot+"/theme/fordson_fel/sections/ajax/register.php?";switch(h+="id="+M.course.id,h+="&what="+g,g){case"collapseall":a(".section.sub").removeClass("expanded"),a(".section.sub").addClass("collapsed"),a(".section-content").addClass("collpased"),a(".section-content").removeClass("expanded"),a(".section-title").attr("aria-expanded","false"),a("img.flexcontrol").attr("src",a("img.flexcontrol").attr("src").replace("expanded","collapsed"));break;case"expandall":a(".section").removeClass("collapsed"),a(".section").addClass("expanded"),a(".section-content").addClass("expanded"),a(".section-content").removeClass("collapsed"),a(".section-title").attr("aria-expanded","true"),a("img.flexcontrol").attr("src",a("img.flexcontrol").attr("src").replace("collapsed","expanded"));break;case"reset":a(".section").removeClass("collapsed"),a(".section").addClass("expanded"),a(".section-content").removeClass("expanded"),a(".section-content").addClass("collapsed"),a(".section-title").attr("aria-expanded","false"),a(".section.isleaf").addClass("expanded"),a(".section.isleaf").removeClass("collapsed"),a(".section.isleaf .section-title").attr("aria-expanded","true")}a.get(h)}};return d});