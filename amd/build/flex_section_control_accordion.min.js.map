{"version":3,"sources":["../src/flex_section_control_accordion.js"],"names":["define","$","config","log","flexsection_control","courseid","init","attribs","on","togglestate","togglekeyreceiver","processglobal","proxysectionnameevent","debug","init_editing","css","e","stopPropagation","preventDefault","handle","find","trigger","hide","that","hasClass","regex","matchs","exec","attr","sectionid","parseInt","sectionsection","level","url","wwwroot","parentid","closest","parent","each","index","value","addClass","removeClass","offset","top","animate","scrollTop","scrollLeft","get","what","keyCode","sectionli","replace","flexcontrol","toggleproxy","proxy"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for controlling the sections.\n *\n * @module     theme_archaius/flex_section_control\n * @package    theme_archaius\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/config', 'core/log'], function($, config, log) {\n\n    /**\n     * SectionControl class.\n     *\n     * @param {String} selector The selector for the page region containing the actions panel.\n     */\n    var flexsection_control = {\n\n        courseid: 0,\n\n        init: function(attribs) {\n\n            this.courseid = attribs;\n\n            // Attach togglestate handler to all flexsections in page.\n            $('.flexcontrol').on('click', this.togglestate);\n            $('.section-caption').on('keydown', this.togglekeyreceiver);\n\n            // Attach global processings.\n            $('.flexsection-global-control').on('click', this.processglobal);\n\n            $('.flexsections > .section > .content > .sectionname').on('click', this.proxysectionnameevent);\n            log.debug('AMD Flex sections control initialized');\n        },\n\n        // Init_editing will NOT take control of section name.\n        init_editing: function(attribs) {\n\n            this.courseid = attribs;\n\n            // Expand everything.\n            $('.section.sub > .content > .section-content').css('display', 'block');\n            $('.section.sub > .content > .section-content').css('visibility', 'visible');\n            $('.section.sub > .content > .summary').css('display', 'block');\n            $('.section.sub > .content > .summary').css('visibility', 'visible');\n            $('.section.sub >.content > .flexsections').css('display', 'block');\n            $('.section.sub >.content > .flexsections').css('visibility', 'visible');\n            // $('.flexcontrol > img').attr('src', $('.flexcontrol > img').attr('src').replace('collapsed', 'expanded'));\n\n            // If collapse mode enabled in editing\n            // Attach togglestate handler to all flexsections in page.\n            $('.flexcontrol').on('click', this.togglestate);\n\n            // Attach global processings.\n            $('.flexsection-global-control').on('click', this.processglobal);\n\n            // Dim toggle buttons. (if collapse mode disabled in edting.\n\n            log.debug('AMD Flex sections control initialized v1.3');\n        },\n\n        proxysectionnameevent: function(e) {\n\n            e.stopPropagation();\n            e.preventDefault();\n            var handle = $(this).find('img');\n            handle.trigger('click');\n\n        },\n\n        togglestate: function(e, hide) {\n\n            e.stopPropagation();\n            e.preventDefault();\n            var that = $(this);\n\n            if (that.hasClass('sectioname')) {\n                var regex = /sectioname-([0-9]+)-section-([0-9]+)/;\n            } else {\n                var regex = /control-([0-9]+)-section-([0-9]+)/;\n            }\n            var matchs = regex.exec(that.attr('id'));\n            var sectionid = parseInt(matchs[1]);\n            var sectionsection = parseInt(matchs[2]);\n            regex = /level-([0-9]+)/;\n            matchs = regex.exec(that.attr('class'));\n            var level = parseInt(matchs[1]);\n\n            log.debug('Working for flex section ' + sectionsection + ' of id ' + sectionid);\n\n            var url = config.wwwroot + '/theme/fordson_fel/sections/ajax/register.php?';\n            url += 'sectionid=' + sectionid;\n            // var handlesrc = $('#control-' + sectionid + '-section-' + sectionsection + ' > img').attr('src');\n\n            if (!hide) {\n                var parentid = that.closest('li').parent().closest('li').attr('id');\n                // Trigger hide event on all siblings.\n                $.each($('#' + parentid + ' .flexcontrol.level-' + level), function(index, value) {\n                    if ($(value).attr('id') != that.attr('id')) {\n                        $(value).trigger('click', true);\n                    }\n                });\n            }\n\n            if (($('#section-' + sectionsection).hasClass('expanded')) ||\n                        (hide === true)) {\n                $('#section-' + sectionsection).addClass('collapsed');\n                $('#section-' + sectionsection).removeClass('expanded');\n                log.debug('Changing section #section-title-' + sectionsection + ' to false');\n                $('#section-title-' + sectionsection).attr('aria-expanded', 'false');\n                $('#section-' + sectionsection + ' > .content > .section-content').addClass('collpased');\n                $('#section-' + sectionsection + ' > .content > .section-content').removeClass('expanded');\n                hide = 1;\n            } else {\n                // Show section.\n                $('#section-' + sectionsection).addClass('expanded');\n                $('#section-' + sectionsection).removeClass('collapsed');\n                log.debug('Changing section #section-title-' + sectionsection + ' to true');\n                $('#section-title-' + sectionsection).attr('aria-expanded', 'true');\n                $('#section-' + sectionsection + ' > .content > .section-content').addClass('expanded');\n                $('#section-' + sectionsection + ' > .content > .section-content').removeClass('collapsed');\n                hide = 0;\n\n                // Scroll to this section.\n                var offset = that.offset();\n                offset.top -= 70;\n                $('html, body').animate({\n                    scrollTop: offset.top,\n                    scrollLeft: 0\n                });\n            }\n\n            url += '&hide=' + hide;\n\n            $.get(url, function() {\n            });\n\n            return false;\n        },\n\n        processglobal: function(e) {\n            e.stopPropagation();\n            e.preventDefault();\n            var that = $(this);\n\n            var regex = /flexsections-control-([a-z]+)/;\n            var matchs = regex.exec(that.attr('id'));\n            var what = matchs[1];\n\n            var url = config.wwwroot + '/theme/fordson_fel/sections/ajax/register.php?';\n            url += 'id=' + flexsection_control.courseid;\n            url += '&what=' + what;\n\n            switch (what) {\n                case 'collapseall':\n                    $('.section.sub').removeClass('expanded');\n                    $('.section.sub').addClass('collapsed');\n                    $('.section-content').addClass('collpased');\n                    $('.section-content').removeClass('expanded');\n                    $('.section-title').attr('aria-expanded', 'false');\n                    // $('.flexcontrol > img').attr('src', $('.flexcontrol > img').attr('src').replace('expanded', 'collapsed'));\n                    break;\n\n                case 'expandall':\n                    $('.section').removeClass('collapsed');\n                    $('.section').addClass('expanded');\n                    $('.section-content').addClass('expanded');\n                    $('.section-content').removeClass('collapsed');\n                    $('.section-title').attr('aria-expanded', 'true');\n                    // $('.flexcontrol > img').attr('src',$('.flexcontrol > img').attr('src').replace('collapsed', 'expanded'));\n                    break;\n\n                case 'map':\n                    $('.section').removeClass('collapsed');\n                    $('.section').addClass('expanded');\n                    $('.section-content').removeClass('expanded');\n                    $('.section-content').addClass('collapsed');\n                    $('.section-title').attr('aria-expanded', 'false');\n                    // Close leaves.\n                    $('.section.isleaf').addClass('expanded');\n                    $('.section.isleaf').removeClass('collapsed');\n                    $('.section.isleaf .section-title').attr('aria-expanded', 'true');\n            }\n\n            // Update positions server side.\n            $.get(url);\n        },\n\n        togglekeyreceiver: function(e) {\n            var that = $(this);\n            // Catch [enter] and [space]\n            if (e.keyCode == 13 || e.keyCode == 32) {\n                var sectionli = that.closest('li');\n                var sectionid = sectionli.attr('id').replace('section-', '');\n                var flexcontrol = that.find('#section-title-' + sectionid + ' > div.flexcontrol');\n                var toggleproxy = $.proxy(flexsection_control.togglestate, flexcontrol);\n                toggleproxy(e);\n            }\n        }\n    };\n\n    return flexsection_control;\n\n});\n"],"file":"flex_section_control_accordion.min.js"}